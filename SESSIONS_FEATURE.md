# Функциональность управления сессиями

## Обзор

Реализована полная функциональность управления сессиями пользователей с возможностью удаления конкретных сессий.

## Компоненты

### 1. SessionsTable (`src/widgets/sessions-table/ui/SessionsTable.tsx`)

Основной компонент таблицы сессий с функциями:
- Отображение всех активных сессий пользователя
- Кнопка удаления для каждой сессии
- Кнопка "Закрыть все сессии"
- Автоматическое определение текущей сессии
- Парсинг User-Agent для отображения браузера и ОС
- Форматирование времени

**Пропсы:**
- `userId?: string` - ID пользователя (для админов)
- `onSessionRevoked?: () => void` - Callback при удалении сессии

### 2. SessionsModal (`src/widgets/sessions-modal/ui/SessionsModal.tsx`)

Модальное окно для отображения таблицы сессий:
- Portal рендеринг в body
- Overlay для закрытия
- Адаптивный дизайн

**Пропсы:**
- `isOpen: boolean` - состояние открытия
- `onClose: () => void` - функция закрытия
- `userId?: string` - ID пользователя
- `title?: string` - заголовок модального окна

### 3. SessionService (`src/shared/lib/api/sessionService.ts`)

API сервис для работы с сессиями:
- `getCurrentUserSessions()` - получение сессий текущего пользователя
- `getUserSessions(userId)` - получение сессий конкретного пользователя
- `revokeSession(sessionId)` - удаление конкретной сессии
- `revokeUserSession(userId, sessionId)` - удаление сессии пользователя (для админов)
- `revokeAllCurrentUserSessions()` - удаление всех сессий текущего пользователя
- `revokeAllUserSessions(userId)` - удаление всех сессий пользователя

### 4. UserSessionManager (обновлен)

Упрощенный компонент, использующий `SessionsTable`:
- Сохранен заголовок и кнопка закрытия
- Вся логика делегирована `SessionsTable`

## Интеграция

### В DashboardPage

Кнопка "Сессии" в хедере (строки 125-133) открывает `UserSessionManager`:
```tsx
<button 
  onClick={() => handleManageSessions(user.id, user.username)}
  className="unified-button bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700"
>
  <Settings className="h-4 w-4" />
  <span>Сессии</span>
</button>
```

### API Endpoints

Сервис использует следующие эндпоинты:
- `GET /api/v1/user/sessions` - сессии текущего пользователя
- `GET /api/v1/admin/users/{userId}/sessions` - сессии пользователя (для админов)
- `DELETE /api/v1/user/sessions/{sessionId}` - удаление сессии
- `DELETE /api/v1/admin/users/{userId}/sessions/{sessionId}` - удаление сессии пользователя
- `POST /api/v1/user/sessions/revoke` - удаление всех сессий
- `POST /api/v1/admin/users/{userId}/sessions/revoke` - удаление всех сессий пользователя

## Особенности

### Текущая сессия

- Автоматически определяется по ID сессии в localStorage
- Нельзя удалить текущую сессию (кнопка скрыта)
- Выделяется синим цветом в таблице

### Безопасность

- Все запросы требуют валидный JWT токен
- Токен автоматически обновляется при необходимости
- При ошибке 401 происходит перенаправление на логин

### UI/UX

- Современный дизайн с Tailwind CSS
- Анимации загрузки и состояний
- Адаптивная таблица с горизонтальным скроллом
- Подтверждение удаления всех сессий

## Использование

1. **Открытие управления сессиями:**
   - Нажмите кнопку "Сессии" в хедере дашборда

2. **Удаление конкретной сессии:**
   - Найдите нужную сессию в таблице
   - Нажмите кнопку "Удалить" рядом с сессией
   - Подтвердите действие

3. **Удаление всех сессий:**
   - Нажмите кнопку "Закрыть все сессии" в верхней части таблицы
   - Подтвердите действие в диалоге

## TypeScript типы

Все типы определены в `src/shared/lib/api/types.ts`:
- `UserSession` - структура сессии
- `SessionRevocationResponse` - ответ при удалении сессии
- `ApiResponse<T>` - общий тип ответа API

## Тестирование

1. Откройте `http://localhost:8080`
2. Войдите в систему
3. Нажмите кнопку "Сессии" в хедере
4. Проверьте отображение таблицы сессий
5. Протестируйте удаление сессий

## Зависимости

- React 18+
- TypeScript
- Tailwind CSS
- Lucide React (иконки)
- Keycloak JS (аутентификация)
